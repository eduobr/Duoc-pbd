----- creacion usuario
CREATE USER guiap11 IDENTIFIED BY practica11
DEFAULT TABLESPACE "USERS"
TEMPORARY TABLESPACE "TEMP";
grant connect, resource, create view, create materialized view to guiap11;


----TABLAS

----TABLA REGION----
CREATE TABLE REGION (
NUMERO INTEGER NOT NULL,
NOMBRE VARCHAR2(150) NOT NULL,
CONSTRAINT PK_REGION PRIMARY KEY(NUMERO) );


-----TABLA COMUNA---
CREATE TABLE COMUNA (
CODIGO INTEGER NOT NULL,
NOMBRE VARCHAR2(150) NOT NULL,
REGION_NUMERO INTEGER NOT NULL,
CONSTRAINT PK_COMUNA PRIMARY KEY(CODIGO),
CONSTRAINT FK_REGION FOREIGN KEY(REGION_NUMERO) REFERENCES REGION(NUMERO));

-----TABLA SALA VENTA
CREATE TABLE SALA_VENTA(
CODIGO INTEGER NOT NULL,
DIRECCION VARCHAR2(200) NOT NULL,
TELEFONO INTEGER NOT NULL,
COMUNA_CODIGO INTEGER NOT NULL,
CONSTRAINT PK_SALA_VENTA PRIMARY KEY(CODIGO),
CONSTRAINT FK_COMUNA FOREIGN KEY(COMUNA_CODIGO) REFERENCES COMUNA(CODIGO));

------TABLA VENDEDOR
CREATE TABLE VENDEDOR(
RUT VARCHAR2(30)NOT NULL,
NOMBRE_COMPLETO VARCHAR2(200)NOT NULL,
SUELDO_BASE INTEGER,
SALA_CODIGO INTEGER NOT NULL,
CONSTRAINT PK_VENDEDOR PRIMARY KEY(RUT),
CONSTRAINT FK_SALA_VENTA FOREIGN KEY(SALA_CODIGO) 
REFERENCES SALA_VENTA(CODIGO));

------TABLA PROYECTO 
CREATE TABLE PROYECTO(
NOMBRE VARCHAR2(150)NOT NULL,
PRECIO_INICIAL_UF NUMBER NOT NULL,
DESCRIPCION VARCHAR2(200)NOT NULL,
CONSTRAINT PK_PROYECTO PRIMARY KEY(NOMBRE));

---TABLA SALA_PROYECTO
CREATE TABLE SALA_PROYECTO(
NUMERO INTEGER NOT NULL,
PROYECTO_NOMBRE VARCHAR2(150) NOT NULL,
SALA_CODIGO INTEGER NOT NULL,
CONSTRAINT PK_SALA_PROYECTO PRIMARY KEY(NUMERO),
CONSTRAINT FK_SALAVENTA FOREIGN KEY(SALA_CODIGO) REFERENCES SALA_VENTA(CODIGO),
CONSTRAINT FK_PROYECTOS FOREIGN KEY(PROYECTO_NOMBRE) REFERENCES PROYECTO(NOMBRE));


----- TABLA CLIENTE
CREATE TABLE CLIENTE(
RUT VARCHAR2(30)NOT NULL,
NOMBRE_COMPLETO VARCHAR2(200) NOT NULL,
SUELDO_LIQUIDO INTEGER,
CONSTRAINT PK_CLIENTE PRIMARY KEY(RUT));


------ TABLA TIPO_VIVIENDA
CREATE TABLE TIPO_VIVIENDA(
CODIGO INTEGER NOT NULL,
DESCRIPCION VARCHAR2(200),
CONSTRAINT PK_TIPO_VIVIENDA PRIMARY KEY(CODIGO));

---- TABLA VIVIENDA
CREATE TABLE VIVIENDA(
NUMERO INTEGER NOT NULL,
NUM_HABITACION INTEGER NOT NULL,
NUM_BAÑOS INTEGER NOT NULL,
MODELO VARCHAR2(150)NOT NULL,
PRECIO_UF NUMBER NOT NULL,
M2 NUMBER NOT NULL,
CODIGO INTEGER NOT NULL,
PROYECTO_NOMBRE VARCHAR2(150)NOT NULL,
CONSTRAINT PK_VIVIENDA PRIMARY KEY(NUMERO),
CONSTRAINT FK_TIPO_VIVIENDA FOREIGN KEY(CODIGO)REFERENCES TIPO_VIVIENDA(CODIGO),
CONSTRAINT FK_PROYECTO FOREIGN KEY(PROYECTO_NOMBRE)REFERENCES PROYECTO(NOMBRE));


------TABLA COTIZACION
CREATE TABLE COTIZACION(
NUMERO_COTIZACION INTEGER NOT NULL,
FECHA DATE NOT NULL,
MONTO_RESERVA INTEGER NOT NULL,
PIE INTEGER NOT NULL,
CLIENTE_RUT VARCHAR2(30)NOT NULL,
VIVIENDA_NUMERO INTEGER NOT NULL,
VENDEDOR_RUT VARCHAR2(30)NOT NULL,
CONSTRAINT PK_COTIZACION PRIMARY KEY(NUMERO_COTIZACION),
CONSTRAINT FK_CLIENTE FOREIGN KEY(CLIENTE_RUT) REFERENCES CLIENTE(RUT),
CONSTRAINT FK_VIVIENDA FOREIGN KEY(VIVIENDA_NUMERO)REFERENCES VIVIENDA(NUMERO),
CONSTRAINT FK_VENDEDOR FOREIGN KEY(VENDEDOR_RUT)REFERENCES VENDEDOR(RUT));


COMMIT;

---DATOS---

----DATOS REGION
INSERT INTO REGION(NUMERO,NOMBRE) VALUES(100,'metropolitana');
INSERT INTO REGION(NUMERO,NOMBRE) VALUES(200,'araucania');
INSERT INTO REGION(NUMERO,NOMBRE) VALUES(300,'valparaiso');

---DATOS COMUNA
INSERT INTO COMUNA(CODIGO,NOMBRE,REGION_NUMERO) VALUES(10,'temuco',200);
INSERT INTO COMUNA(CODIGO,NOMBRE,REGION_NUMERO) VALUES(20,'puente alto',100);
INSERT INTO COMUNA(CODIGO,NOMBRE,REGION_NUMERO) VALUES(30,'viña del mar',300);
INSERT INTO COMUNA(CODIGO,NOMBRE,REGION_NUMERO) VALUES(40,'pucon',200);
INSERT INTO COMUNA(CODIGO,NOMBRE,REGION_NUMERO) VALUES(50,'las condes',100);

----- DATOS SALA VENTA
INSERT INTO SALA_VENTA(CODIGO,DIRECCION,TELEFONO,COMUNA_CODIGO) VALUES (1001,'av.san carlos 452',27895482,20);
INSERT INTO SALA_VENTA(CODIGO,DIRECCION,TELEFONO,COMUNA_CODIGO) VALUES (1005,'san martin 564',4565656,30);
INSERT INTO SALA_VENTA(CODIGO,DIRECCION,TELEFONO,COMUNA_CODIGO) VALUES (1007,'libertador 6454',4567676,40);
INSERT INTO SALA_VENTA(CODIGO,DIRECCION,TELEFONO,COMUNA_CODIGO) VALUES (1002,'portales 785',21457847,30);
INSERT INTO SALA_VENTA(CODIGO,DIRECCION,TELEFONO,COMUNA_CODIGO) VALUES (1009,'bello 733',9800888,10);
INSERT INTO SALA_VENTA(CODIGO,DIRECCION,TELEFONO,COMUNA_CODIGO) VALUES (1011,'tomas moro 123',56788666,50);

----- DATOS PROYECTO
INSERT INTO PROYECTO(NOMBRE,PRECIO_INICIAL_UF,DESCRIPCION) VALUES ('sol poniente',2700,'buen sector');
INSERT INTO PROYECTO(NOMBRE,PRECIO_INICIAL_UF,DESCRIPCION) VALUES ('huertos pehuen',1880,'en carretera 5 sur');
INSERT INTO PROYECTO(NOMBRE,PRECIO_INICIAL_UF,DESCRIPCION) VALUES ('cumbres',3900,'parque residencial');

------ DATOS SALA PROYECTO
INSERT INTO SALA_PROYECTO(PROYECTO_NOMBRE,SALA_CODIGO,NUMERO)VALUES('sol poniente',1001,5001);
INSERT INTO SALA_PROYECTO(PROYECTO_NOMBRE,SALA_CODIGO,NUMERO)VALUES('huertos pehuen',1002,3001);
INSERT INTO SALA_PROYECTO(PROYECTO_NOMBRE,SALA_CODIGO,NUMERO)VALUES('cumbres',1007,7001);

------ DATOS VENDEDOR
INSERT INTO VENDEDOR(RUT,NOMBRE_COMPLETO,SUELDO_BASE,SALA_CODIGO) VALUES('150-9','juan carlos mella',556500,1001);
INSERT INTO VENDEDOR(RUT,NOMBRE_COMPLETO,SUELDO_BASE,SALA_CODIGO) VALUES('180-4','cecilia lobos rojas',789000,1002);
INSERT INTO VENDEDOR(RUT,NOMBRE_COMPLETO,SUELDO_BASE,SALA_CODIGO) VALUES('140-5','juan luis soto abarca',878000,1001);

----DATOS CLIENTE
INSERT INTO CLIENTE(RUT,NOMBRE_COMPLETO,SUELDO_LIQUIDO)VALUES('101-3','marco peña soto',1158000);
INSERT INTO CLIENTE(RUT,NOMBRE_COMPLETO,SUELDO_LIQUIDO)VALUES('104-8','ines mella perales',1257550);
INSERT INTO CLIENTE(RUT,NOMBRE_COMPLETO,SUELDO_LIQUIDO)VALUES('106-6','francisco correa salas',980000);

-----DATOS TIPO_VIVIENDA
INSERT INTO TIPO_VIVIENDA(CODIGO,DESCRIPCION)VALUES(200,'casa');
INSERT INTO TIPO_VIVIENDA(CODIGO,DESCRIPCION)VALUES(300,'departamento');

---DATOS VIVIENDA
INSERT INTO VIVIENDA(NUMERO,NUM_HABITACION,NUM_BAÑOS,MODELO,PRECIO_UF,M2,CODIGO,PROYECTO_NOMBRE) VALUES(2207,4,2,'castaños',3010,125,200,'huertos pehuen');
INSERT INTO VIVIENDA(NUMERO,NUM_HABITACION,NUM_BAÑOS,MODELO,PRECIO_UF,M2,CODIGO,PROYECTO_NOMBRE)VALUES(189,3,2,'san pedro',2970,101,300,'sol poniente');
INSERT INTO VIVIENDA(NUMERO,NUM_HABITACION,NUM_BAÑOS,MODELO,PRECIO_UF,M2,CODIGO,PROYECTO_NOMBRE)VALUES(198,4,3,'almendro',3330,140,200,'huertos pehuen');
INSERT INTO VIVIENDA(NUMERO,NUM_HABITACION,NUM_BAÑOS,MODELO,PRECIO_UF,M2,CODIGO,PROYECTO_NOMBRE)VALUES(1501,2,1,'castaños',2345,75,200,'huertos pehuen');
INSERT INTO VIVIENDA(NUMERO,NUM_HABITACION,NUM_BAÑOS,MODELO,PRECIO_UF,M2,CODIGO,PROYECTO_NOMBRE)VALUES(345,2,2,'san pedro',2378,101,300,'sol poniente');
INSERT INTO VIVIENDA(NUMERO,NUM_HABITACION,NUM_BAÑOS,MODELO,PRECIO_UF,M2,CODIGO,PROYECTO_NOMBRE)VALUES(199,4,3,'almendro',3145,120,200,'huertos pehuen');


---DATOS COTIZACION
INSERT INTO COTIZACION(NUMERO_COTIZACION,FECHA,MONTO_RESERVA,PIE,CLIENTE_RUT,VIVIENDA_NUMERO,VENDEDOR_RUT)
VALUES(1089,'25-09-2015',350000,2500000,'101-3',189,'150-9');
INSERT INTO COTIZACION(NUMERO_COTIZACION,FECHA,MONTO_RESERVA,PIE,CLIENTE_RUT,VIVIENDA_NUMERO,VENDEDOR_RUT)
VALUES(1090,'17-09-2015',550000,1850000,'104-8',2207,'180-4');
INSERT INTO COTIZACION(NUMERO_COTIZACION,FECHA,MONTO_RESERVA,PIE,CLIENTE_RUT,VIVIENDA_NUMERO,VENDEDOR_RUT)
VALUES(1345,'10-09-2015',350000,2500000,'104-8',198,'180-4');
INSERT INTO COTIZACION(NUMERO_COTIZACION,FECHA,MONTO_RESERVA,PIE,CLIENTE_RUT,VIVIENDA_NUMERO,VENDEDOR_RUT)
VALUES(3456,'09-10-2015',450000,2150000,'101-3',189,'150-9');

commit;


CREATE TABLE ERRORES (
SQ_ERROR INTEGER NOT NULL,
ID_VIVIENDA NUMBER(10) NOT NULL,
MENSAJE VARCHAR2(100) NOT NULL,
CONSTRAINT PK_errores PRIMARY KEY(SQ_ERROR) );


create sequence id_ERRORES
minvalue 1
maxvalue 99999999
start with 1
increment by 1;


CREATE TABLE CLAVES_USUARIO (
NOMBRE_USUARIO VARCHAR2(100) NOT NULL,
CONTRASEÑA VARCHAR2(100) NOT NULL);



CREATE tablE DETALLE_COTIZACION_DIARIO (
DIA NUMBER NOT NULL,
MES NUMBER NOT NULL,
AÑO NUMBER NOT NULL,
NUMERO_VIVIENDA NUMBER,
NOMBRE_CLIENTE VARCHAR2(150) NOT NULL,
MONTO_RESERVA VARCHAR2(150) NOT NULL,
MONTO_VIVIENDA_PESOS VARCHAR2(150) NOT NULL);


CREATE tablE RESUMEN_COTIZACION_MENSUAL (
MES NUMBER NOT NULL,
CANTIDAD_COTIZACIONES NUMBER NOT NULL,
NUMERO_SALA VARCHAR2(150) NOT NULL,
SUMA_MENSUAL_PESOS number NOT NULL);



COMMIT;

